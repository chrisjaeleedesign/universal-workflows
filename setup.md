---
name: setup
description: Initialize or Repair the Antigravity Workflow Registry.
allowed-tools: [list_dir, view_file, write_to_file, run_command]
---

<role>System Installer & Linker</role>

<input>
$ARGUMENTS: Optional "force" flag to overwrite without asking (implied).
</input>

<context>
Universal Manifest: @.agent/workflows/universal-workflows/universal_manifest.md
Project Root: .agent/workflows/local-workflows
</context>

<process>
<step_1_universal>
<title>Load Universal Kernel</title>
1.  **Read Manifest**: Read `@.agent/workflows/universal-workflows/universal_manifest.md`.
2.  **Verify Integrity**:
    -   For each entry in the manifest, check if the file exists using `ls .agent/workflows/{path}`.
    -   If a file is missing, log a WARNING but continue.
3.  **Buffer**: Keep the verified universal entries in memory.
</step_1_universal>

<step_2_discovery>
<title>Discover Project Tools</title>
1.  **Scan**:
    -   Target Directory: `.agent/workflows/local-workflows/`.
2.  **Crawl**:
    -   Recursively find `*.md` files in this directory.
    -   *Exclude*: `README.md`, `standards.md`, `references/`.
3.  **Deep Analysis**:
    -   For each discovered file:
        -   **Read**: Use `view_file` to read the first 50 lines.
        -   **Extract**:
            -   `name`: Filename (sans extension).
            -   `role`: Content inside `<role>...</role>`.
            -   `desc`: Content inside `description:` YAML frontmatter.
        -   **Format**: Create a registry entry.
</step_2_discovery>

<step_3_register>
<title>Build Registry</title>
1.  **Compile**: Combine **Universal Entries** and **Discovered Project Entries**.
2.  **Write Artifact**:
    -   Target: `.agent/workflows/workflow_registry.md`
    -   Format: Markdown/XML Hybrid.
    
    ```markdown
    # Workflow Registry
    > Generated by /setup. Do not edit manually. Last updated: {TIMESTAMP}
    
    ## Universal Kernel
    <universal>
    - name: {name}
      path: .agent/workflows/{path}
      role: {role}
      desc: {desc}
    ...
    </universal>
    
    ## Project Tools
    <project>
    - name: {name}
      path: .agent/workflows/local-workflows/{category}/{filename}
      role: {role}
      desc: {desc}
    ...
    </project>
    ```

3.  **Persist**: Save the file.
4.  **Report**: "Registry initialized with X universal tools and Y project tools."
</step_3_register>
</process>
